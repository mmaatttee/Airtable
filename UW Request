/* CONFIG */
const aliasColumn = 'Alias'
const pointerColumn = 'Pointer'
const resultColumn = 'Description'
/* Table & View ID */
let tableId = cursor.activeTableId;
let table = base.getTable(tableId);
let viewID = cursor.activeViewId;
let view = table.getView(viewID);

//console.log(view);

let result = await view.selectRecordsAsync();

//console.log(result);

for (let record of result.records) 
{
    let alias = record.getCellValueAsString(aliasColumn)
    let searchalias = encodeURIComponent(alias)
    let pointer = record.getCellValueAsString(pointerColumn)
    let searchpointer = encodeURIComponent(pointer)
    let recordName = record.name;
    let uwurl = 'https://digitalcollections.lib.washington.edu/digital/bl/dmwebservices/index.php?q=dmGetItemInfo/' + searchalias + '/' + searchpointer + '/json';
    let UWResponse = await fetch(uwurl);
    let UWJSON = await UWResponse.json();
    let UWDescri = UWJSON["descri"];
        //console.log(uwurl);
        //console.log(UWDescri);
     try {
           await table.updateRecordAsync(record, {[resultColumn]: UWDescri,});
        }
        catch(e) {
            output.markdown(`UW info for ${recordName}, i.e. the "${alias}" and "${pointer}" pair, returned null. This is likely because the 'descri' value in the original JSON string is empty.`)
        }
    
}
