/* CONFIG */
let aliasColumn = 'Alias'
let pointerColumn = 'Pointer'
let resultColumn = 'Description'
/* Table & View ID */
let tableID = cursor.activeTableId;
let table = base.getTable(tableID);
let viewID = cursor.activeViewId;
let view = table.getView(viewID);


/* SCRIPT */

/* list of all records in view */
let result = await view.selectRecordsAsync();
for (let record of result.records) {
    /* alias */
    let alias = record.getCellValueAsString(aliasColumn)
    let searchAlias = encodeURIComponent(alias)
    if (alias == null) {continue}
    /* pointer */
    let pointer = record.getCellValueAsString(pointerColumn)
    let searchPointer = encodeURIComponent(pointer)
    if (pointer == null) {continue}
    /* skips request if airtable record already has a description */
    if (record.getCellValue(resultColumn) == null) {
        let UWURL = 
            'https://digitalcollections.lib.washington.edu/digital/bl/dmwebservices/index.php?q=dmGetItemInfo/' + searchAlias + '/' + searchPointer + '/json';
        let UWResponse = await fetch(UWURL);
        let UWJSON = await UWResponse.json();
        }
        catch(e) {
            console.error(
            `UW search for "${alias}" and "${pointer} returned an undefined object.
            This is likely because no such UW object exists`
            )
        }
        await table.updateRecordAsync(record, {[resultColumn]: wikiIntroText,});
    }
}
output.markdown('# done')
